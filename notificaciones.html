<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#020617">
    <title>Notificaciones | Padeluminatis Pro</title>
    <meta name="description" content="Tus alertas y notificaciones de Padeluminatis">
    <link rel="icon" type="image/x-icon" href="./imagenes/Logojafs.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./css/design-system.css">
    <link rel="stylesheet" href="./css/layout.css">
    <link rel="stylesheet" href="./css/components-premium.css">
    <link rel="stylesheet" href="./css/themes.css">
    <link rel="stylesheet" href="./css/notificaciones.css">
</head>

<body>
    <!-- Galactic Background -->
    <!-- Galactic Background -->
    <div class="sport-bg"></div>

    <!-- Header & Nav injected by JS -->

    <main class="page-content notif-page">

        <!-- Permission Card -->
        <section class="permission-card animate-fade-in" id="permission-area">
            <div class="permission-icon">
                <i class="fas fa-bell"></i>
                <div class="permission-pulse"></div>
            </div>
            <div class="permission-content">
                <h3 class="permission-title">Activa tus Alertas</h3>
                <p class="permission-text">Recibe avisos de partidos, retos y mensajes aunque no estés en la App.</p>
            </div>
            <button class="btn btn-primary w-full" id="btn-request-push">
                <i class="fas fa-bell-on"></i>
                Permitir Notificaciones
            </button>
        </section>

        <!-- Page Header -->
        <section class="notif-header animate-fade-in" style="animation-delay: 0.1s;">
            <div class="notif-header-row">
                <h1 class="page-title">Bandeja de Entrada</h1>
                <div class="notif-actions">
                    <button class="action-btn danger" id="btn-clear-all" title="Borrar Historial">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                    <button class="action-btn primary" id="btn-read-all" title="Marcar todo como leído">
                        <i class="fas fa-check-double"></i>
                    </button>
                </div>
            </div>
        </section>

        <!-- Filter Tabs -->
        <section class="filter-section animate-fade-in" style="animation-delay: 0.15s;">
            <div class="filter-tabs" id="filter-tabs">
                <button class="filter-tab active" data-filter="all">Todas</button>
                <button class="filter-tab" data-filter="unread">No Leídas</button>
                <button class="filter-tab" data-filter="read">Leídas</button>
            </div>
        </section>

        <!-- Notifications List -->
        <section class="notif-section animate-fade-in" style="animation-delay: 0.2s;">
            <div id="notif-list" class="notif-list">
                <!-- Loading State -->
                <div class="notif-loading">
                    <div class="spinner-neon"></div>
                    <span>Cargando notificaciones...</span>
                </div>
            </div>
        </section>

    </main>

    <script type="module">
        import { initAppUI, showToast } from './js/ui-core.js';
        import { auth, observerAuth, getDocument } from './js/firebase-service.js';

        document.addEventListener('DOMContentLoaded', async () => {
            initAppUI('notifications');

            // Notification Permission Logic
            const btnPush = document.getElementById('btn-request-push');
            const permArea = document.getElementById('permission-area');

            if ("Notification" in window) {
                if (Notification.permission === 'granted') {
                    permArea.style.display = 'none';
                }

                btnPush.onclick = async () => {
                    const permission = await Notification.requestPermission();
                    if (permission === 'granted') {
                        permArea.innerHTML = `
                            <div class="permission-icon success">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="permission-content">
                                <h3 class="permission-title">¡Sistema Activo!</h3>
                                <p class="permission-text">Te avisaremos de cualquier novedad importante.</p>
                            </div>
                        `;
                        permArea.classList.add('success');
                        setTimeout(() => permArea.style.display = 'none', 3000);
                        showToast('Notificaciones activadas', 'success');
                    } else if (permission === 'denied') {
                        showToast('Permisos de notificación denegados', 'error');
                    }
                };
            } else {
                permArea.style.display = 'none';
            }
        });
    </script>
    <script type="module" src="./js/notificaciones.js"></script>
    <script type="module">
        import { initGalaxyBackground } from './js/modules/galaxy-bg.js';
        initGalaxyBackground();
    </script>

</body>

</html>